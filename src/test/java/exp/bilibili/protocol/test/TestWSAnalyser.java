package exp.bilibili.protocol.test;

import exp.libs.utils.num.BODHUtils;
import exp.libs.utils.other.StrUtils;

/**
 * <PRE>
 * 测试WebSocket的接收报文
 * </PRE>
 * <br/><B>PROJECT : </B> bilibili-plugin
 * <br/><B>SUPPORT : </B> <a href="http://www.exp-blog.com" target="_blank">www.exp-blog.com</a> 
 * @version   2017-12-17
 * @author    EXP: 272629724@qq.com
 * @since     jdk版本：jdk1.6
 */
public class TestWSAnalyser {

	public static void main(String[] args) {
		String hex = "0000006E0010000000000005000000007B22636D64223A2247554152445F4D5347222C226D7367223A223A3FE79DA1E4B88DE5A49FE79A84E88C9CE88C9CE88C9C3A3F20E59CA8E69CACE688BFE997B4E5BC80E9809AE4BA86E888B0E995BF222C226275795F74797065223A337D000004D30010000000000005000000007B22636D64223A224E4F544943455F4D5347222C2266756C6C223A7B22686561645F69636F6E223A22687474703A5C2F5C2F69302E6864736C622E636F6D5C2F6266735C2F6C6976655C2F373233333765383630323062386430383734643831376631356334386136313038393462393466662E706E67222C227461696C5F69636F6E223A22687474703A5C2F5C2F69302E6864736C622E636F6D5C2F6266735C2F6C6976655C2F383232646134383166646162613938366437333864623564386664343639666661393561386661312E77656270222C22686561645F69636F6E5F6661223A22687474703A5C2F5C2F69302E6864736C622E636F6D5C2F6266735C2F6C6976655C2F373233333765383630323062386430383734643831376631356334386136313038393462393466662E706E67222C227461696C5F69636F6E5F6661223A22687474703A5C2F5C2F69302E6864736C622E636F6D5C2F6266735C2F6C6976655C2F333863623261396631323039623136633066313531363262306235353365336232386439663136662E706E67222C22686561645F69636F6E5F66616E223A312C227461696C5F69636F6E5F66616E223A342C226261636B67726F756E64223A22234646423033434646222C22636F6C6F72223A22234646464646464646222C22686967686C69676874223A22234232354143314646222C2274696D65223A31307D2C2268616C66223A7B22686561645F69636F6E223A22222C227461696C5F69636F6E223A22222C226261636B67726F756E64223A22222C22636F6C6F72223A22222C22686967686C69676874223A22222C2274696D65223A387D2C2273696465223A7B22686561645F69636F6E223A22687474703A5C2F5C2F69302E6864736C622E636F6D5C2F6266735C2F6C6976655C2F333135363664386364356434363863333064653863313438633564303662336233343564383333332E706E67222C226261636B67726F756E64223A22234646453943384646222C22636F6C6F72223A22234546393033414646222C22686967686C69676874223A22234435343930304646222C22626F72646572223A22234646434641344646227D2C22726F6F6D6964223A3338372C227265616C5F726F6F6D6964223A3238303434362C226D73675F636F6D6D6F6E223A223C255C75373736315C75346530645C75353931665C75373638345C75383331635C75383331635C7538333163253E205C75353732385C75363732635C75363233665C75393566345C75356630305C75393031615C75346538365C75383233305C7539353766222C226D73675F73656C66223A223C255C75373736315C75346530645C75353931665C75373638345C75383331635C75383331635C7538333163253E205C75353732385C75363732635C75363233665C75393566345C75356630305C75393031615C75346538365C75383233305C7539353766222C226C696E6B5F75726C223A2268747470733A5C2F5C2F6C6976652E62696C6962696C692E636F6D5C2F3238303434363F6C6976655F6C6F74746572795F747970653D322662726F6164636173745F747970653D302666726F6D3D32383030332665787472615F6A756D705F66726F6D3D3238303033222C226D73675F74797065223A332C22736869656C645F756964223A2D317D000000F20010000000000005000000007B22636D64223A2247554152445F425559222C2264617461223A7B22756964223A393337373233312C22757365726E616D65223A225C75373736315C75346530645C75353931665C75373638345C75383331635C75383331635C7538333163222C2267756172645F6C6576656C223A332C226E756D223A312C227072696365223A3139383030302C22676966745F6964223A31303030332C22676966745F6E616D65223A225C75383233305C7539353766222C2273746172745F74696D65223A313533383237333730392C22656E645F74696D65223A313533383237333730397D7D000002400010000000000005000000007B22636D64223A2247554152445F4C4F54544552595F5354415254222C2264617461223A7B226964223A3437333931382C22726F6F6D6964223A3238303434362C226D657373616765223A22E79DA1E4B88DE5A49FE79A84E88C9CE88C9CE88C9C20E59CA8E38090323830343436E38091E8B4ADE4B9B0E4BA86E888B0E995BFEFBC8CE8AFB7E5898DE5BE80E68ABDE5A596222C2274797065223A226775617264222C2270726976696C6567655F74797065223A332C226C696E6B223A2268747470733A5C2F5C2F6C6976652E62696C6962696C692E636F6D5C2F323830343436222C22706179666C6F775F6964223A227765625F3365373664653830343333393461303930385F323031383039222C226C6F7474657279223A7B226964223A3437333931382C2273656E646572223A7B22756964223A393337373233312C22756E616D65223A22E79DA1E4B88DE5A49FE79A84E88C9CE88C9CE88C9C222C2266616365223A22687474703A5C2F5C2F69322E6864736C622E636F6D5C2F6266735C2F666163655C2F326430613465613262373235386531343238396238653830323266613865373935386536303563382E6A7067227D2C226B6579776F7264223A226775617264222C2274696D65223A313230302C22737461747573223A312C226D6F62696C655F646973706C61795F6D6F6465223A322C226D6F62696C655F7374617469635F6173736574223A22222C226D6F62696C655F616E696D6174696F6E5F6173736574223A22227D7D7D000000940010000000000005000000007B22636D64223A2257454C434F4D455F4755415244222C2264617461223A7B22756964223A393337373233312C22757365726E616D65223A225C75373736315C75346530645C75353931665C75373638345C75383331635C75383331635C7538333163222C2267756172645F6C6576656C223A332C2277617465725F676F64223A307D7D";
		alalyseMsg(hex);
	}
	
	private static void alalyseMsg(String hexMsg) {
		byte[] bytes = BODHUtils.toBytes(hexMsg);
		String msg = new String(bytes);
		System.out.println(StrUtils.view(msg));
		System.out.println("====");
		
		int len = 0;
		do {
			len = getLen(hexMsg);
			if(len <= 32) {
				break;
			}
			String subHexMsg = hexMsg.substring(32, len);
			msg = new String(BODHUtils.toBytes(subHexMsg));
			System.out.println(StrUtils.view(msg));
			
			
			hexMsg = hexMsg.substring(len);
		} while(StrUtils.isNotEmpty(hexMsg));
	}
	
	private static int getLen(String hexMsg) {
		String hexLen = hexMsg.substring(0, 8);	// 消息的前8位是本条消息长度
		long len = BODHUtils.hexToDec(hexLen);
		return (int) (len * 2);
	}
	
}
