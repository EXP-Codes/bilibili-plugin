package exp.bilibili.protocol.test;

import exp.libs.utils.num.BODHUtils;
import exp.libs.utils.other.StrUtils;

/**
 * <PRE>
 * 测试WebSocket的接收报文
 * </PRE>
 * <br/><B>PROJECT : </B> bilibili-plugin
 * <br/><B>SUPPORT : </B> <a href="http://www.exp-blog.com" target="_blank">www.exp-blog.com</a> 
 * @version   2017-12-17
 * @author    EXP: 272629724@qq.com
 * @since     jdk版本：jdk1.6
 */
public class TestWSAnalyser {

	public static void main(String[] args) {
		String hex = "000001190010000000000005000000007B22636D64223A2244414E4D555F4D5347222C22696E666F223A5B5B302C312C32352C31363737373231352C313534303738303638362C313534303738303638362C302C226432383938646630222C302C325D2C225C75353464345C75353465395C75353464345C753534653920285C75333039632D5C7533303963295C75333036345C7533306564205C75356537325C75363736667E222C5B3337333031353936322C22416C6C656E5C75386332325C75363031645C7535623837222C302C302C302C223130303030222C312C22225D2C5B5D2C5B31312C302C363430363233342C223E3530303030225D2C5B5D2C302C305D2C22726F6F6D6964223A223131303639303234227D000001800010000000000005000000007B22636D64223A2244414E4D555F4D5347222C22696E666F223A5B5B302C312C32352C31363737373231352C313534303738303638372C313534303738303638372C302C223865336363343530222C302C325D2C225C75353464345C75353465395C75353464345C753534653920285C75333039632D5C7533303963295C75333036345C7533306564205C75356537325C75363736667E222C5B3434333636332C225C75383239395C75376635375C7536326339222C302C302C302C223130303030222C312C22225D2C5B31302C225C75373637655C7535343038222C225C75373436305C75373438335C75383237325C75333036655C75353932395C75346637665C75333036375C7533303539222C3331373533342C31303531323632352C22225D2C5B34342C302C31363734363136322C373839395D2C5B227469746C652D3134342D32222C227469746C652D3134342D32225D2C302C305D2C22726F6F6D6964223A223131303639303234227D000001790010000000000005000000007B22636D64223A2244414E4D555F4D5347222C22696E666F223A5B5B302C312C32352C31363737373231352C313534303738303638372C313534303738303638372C302C226338656330386562222C302C325D2C225C75353464345C75353465395C75353464345C753534653920285C75333039632D5C7533303963295C75333036345C7533306564205C75356537325C75363736667E222C5B38353331333138362C225C75376364365C75346539345C7535313534222C302C312C302C223130303030222C312C22225D2C5B31362C225C75363231315C75353461395C7535343430222C225C75346636305C75373638345C75376638615C75353461395C75353461392D222C363830363738372C31363734363136322C22225D2C5B33392C302C31303531323632352C31373436305D2C5B227469746C652D3137342D32222C227469746C652D3137342D32225D2C302C305D2C22726F6F6D6964223A223131303639303234227D000001950010000000000005000000007B22636D64223A2244414E4D555F4D5347222C22696E666F223A5B5B302C312C32352C31363737373231352C313534303738303638372C313534303738303638372C302C223432323235653161222C302C325D2C225C75353464345C75353465395C75353464345C753534653920285C75333039632D5C7533303963295C75333036345C7533306564205C75356537325C75363736667E222C5B3335323232343130352C224461652D5C75356637315C7535313366222C302C302C302C223130303030222C312C22225D2C5B342C225C75363661375C75363661655C7537333936222C225C75363661655C75363661655C75363632665C75346532615C75366361315C75363131665C75363063355C75373638345C75363734305C7536323462222C333739383938362C363430363233342C22225D2C5B31382C302C363430363233342C223E3530303030225D2C5B227469746C652D3135342D31222C227469746C652D3135342D31225D2C302C305D2C22726F6F6D6964223A223131303639303234227D0000017D0010000000000005000000007B22636D64223A2244414E4D555F4D5347222C22696E666F223A5B5B302C312C32352C31363737373231352C313534303738303638372C313534303738303638372C302C226638346531373866222C302C325D2C225C75353464345C75353465395C75353464345C753534653920285C75333039632D5C7533303963295C75333036345C7533306564205C75356537325C75363736667E222C5B313538323938322C225C75396536345C75346533385C75356635325C7535623838222C302C302C302C223130303030222C312C22225D2C5B322C225C75366232315C75393937635C7539393763222C225C75376338395C75393937635C75363235315C75363235315C7534653336222C373939383139372C363430363233342C22225D2C5B32342C302C353830353739302C223E3530303030225D2C5B227469746C652D3137302D31222C227469746C652D3137302D31225D2C302C305D2C22726F6F6D6964223A223131303639303234227D0000045B0010000000000005000000007B22636D64223A2254565F454E44222C2264617461223A7B226964223A22313635373430222C22756E616D65223A225C75346563375C75356262365C75353932615C75353931615C75346530645C75363133665C75363130665C75393030665C75393733325C75353964335C75353430645C75373638345C75363764305C7536393630222C22736E616D65223A225C75393535635C75383635615C7535343064222C22676966744E616D65223A22313030303030785C75393466365C75373464635C7535623530222C226D6F62696C6554697073223A225C75363036645C7535353963205C75346563375C75356262365C75353932615C75353931615C75346530645C75363133665C75363130665C75393030665C75393733325C75353964335C75353430645C75373638345C75363764305C7536393630205C75383362375C7535663937313030303030785C75393466365C75373464635C7535623530222C22726166666C654964223A22313635373430222C2274797065223A22736D616C6C5F7476222C2266726F6D223A225C75393535635C75383635615C7535343064222C2266726F6D46616365223A22687474703A5C2F5C2F69312E6864736C622E636F6D5C2F6266735C2F666163655C2F306264393037313962336664323737333963363938646237666632346435303036333063373638352E6A7067222C2266726F6D476966744964223A32352C2277696E223A7B22756E616D65223A225C75346563375C75356262365C75353932615C75353931615C75346530645C75363133665C75363130665C75393030665C75393733325C75353964335C75353430645C75373638345C75363764305C7536393630222C2266616365223A22687474703A5C2F5C2F69302E6864736C622E636F6D5C2F6266735C2F666163655C2F316662653138383632343164323666326335356132363330616436343466653661303930656330362E6A7067222C22676966744E616D65223A225C75393466365C75373464635C7535623530222C22676966744964223A2273696C766572222C22676966744E756D223A3130303030302C2267696674496D616765223A22687474703A5C2F5C2F73312E6864736C622E636F6D5C2F6266735C2F6C6976655C2F303064373638623434346631653131393733313265353735333133323563646536366266303535362E706E67222C226D7367223A225C75363036645C7535353963203C255C75346563375C75356262365C75353932615C75353931615C75346530645C75363133665C75363130665C75393030665C75393733325C75353964335C75353430645C75373638345C75363764305C7536393630253E205C75383362375C75356639375C75353932375C7535393536203C25313030303030785C75393466365C75373464635C7535623530253E2C205C75363131665C7538633232203C255C75393535635C75383635615C7535343064253E205C75373638345C75386436305C7539303031227D7D7D000004A40010000000000005000000007B22636D64223A224E4F544943455F4D5347222C2266756C6C223A7B22686561645F69636F6E223A22687474703A5C2F5C2F69302E6864736C622E636F6D5C2F6266735C2F6C6976655C2F633336623135343034343431323339613232633564373834363362333037643964636464666366372E77656270222C227461696C5F69636F6E223A22222C22686561645F69636F6E5F6661223A22687474703A5C2F5C2F69302E6864736C622E636F6D5C2F6266735C2F6C6976655C2F663162353764656162626164323736626236353838323666376539313039313062356438373837352E706E67222C227461696C5F69636F6E5F6661223A22222C22686561645F69636F6E5F66616E223A31322C227461696C5F69636F6E5F66616E223A302C226261636B67726F756E64223A22234136373134414646222C22636F6C6F72223A22234646464646464646222C22686967686C69676874223A22234644464632464646222C2274696D65223A31307D2C2268616C66223A7B22686561645F69636F6E223A22687474703A5C2F5C2F69302E6864736C622E636F6D5C2F6266735C2F6C6976655C2F656339623337346361656335626438343839386633373830613130313839626539366238366434652E706E67222C227461696C5F69636F6E223A22222C226261636B67726F756E64223A22234445394337324646222C22636F6C6F72223A22234646464646464646222C22686967686C69676874223A22234644464632464646222C2274696D65223A387D2C2273696465223A7B22686561645F69636F6E223A22222C226261636B67726F756E64223A22222C22636F6C6F72223A22222C22686967686C69676874223A22222C22626F72646572223A22227D2C22726F6F6D6964223A31313036393032342C227265616C5F726F6F6D6964223A302C226D73675F636F6D6D6F6E223A225C75363036645C7535353963203C255C75346563375C75356262365C75353932615C75353931615C75346530645C75363133665C75363130665C75393030665C75393733325C75353964335C75353430645C75373638345C75363764305C7536393630253E205C75383362375C75356639375C75353932375C7535393536203C25313030303030785C75393466365C75373464635C7535623530253E2C205C75363131665C7538633232203C255C75393535635C75383635615C7535343064253E205C75373638345C75386436305C7539303031222C226D73675F73656C66223A225C75363036645C7535353963203C255C75346563375C75356262365C75353932615C75353931615C75346530645C75363133665C75363130665C75393030665C75393733325C75353964335C75353430645C75373638345C75363764305C7536393630253E205C75383362375C75356639375C75353932375C7535393536203C25313030303030785C75393466365C75373464635C7535623530253E2C205C75363131665C7538633232203C255C75393535635C75383635615C7535343064253E205C75373638345C75386436305C7539303031222C226C696E6B5F75726C223A22222C226D73675F74797065223A352C22736869656C645F756964223A2D317D000001380010000000000005000000007B22636D64223A2244414E4D555F4D5347222C22696E666F223A5B5B302C312C32352C31363737373231352C313534303738303638372C313534303738303638372C302C226432613730633562222C302C325D2C225C75353464345C75353465395C75353464345C753534653920285C75333039632D5C7533303963295C75333036345C7533306564205C75356537325C75363736667E222C5B3130383236343439302C225C75393633665C75376133335F5C75353937645C75353465355C7535346535222C302C312C312C223130303030222C312C22225D2C5B5D2C5B33352C302C31303531323632352C33333038365D2C5B227469746C652D38362D31222C227469746C652D38362D31225D2C302C305D2C22726F6F6D6964223A223131303639303234227D";
		alalyseMsg(hex);
	}
	
	private static void alalyseMsg(String hexMsg) {
		byte[] bytes = BODHUtils.toBytes(hexMsg);
		String msg = new String(bytes);
		System.out.println(StrUtils.view(msg));
		System.out.println("====");
		
		int len = 0;
		do {
			len = getLen(hexMsg);
			if(len <= 32) {
				break;
			}
			String subHexMsg = hexMsg.substring(32, len);
			msg = new String(BODHUtils.toBytes(subHexMsg));
			System.out.println(StrUtils.view(msg));
			
			
			hexMsg = hexMsg.substring(len);
		} while(StrUtils.isNotEmpty(hexMsg));
	}
	
	private static int getLen(String hexMsg) {
		String hexLen = hexMsg.substring(0, 8);	// 消息的前8位是本条消息长度
		long len = BODHUtils.hexToDec(hexLen);
		return (int) (len * 2);
	}
	
}
