package exp.bilibili.protocol.test;

import exp.libs.utils.num.BODHUtils;
import exp.libs.utils.other.StrUtils;

/**
 * <PRE>
 * 测试WebSocket的接收报文
 * </PRE>
 * <br/><B>PROJECT : </B> bilibili-plugin
 * <br/><B>SUPPORT : </B> <a href="http://www.exp-blog.com" target="_blank">www.exp-blog.com</a> 
 * @version   2017-12-17
 * @author    EXP: 272629724@qq.com
 * @since     jdk版本：jdk1.6
 */
public class TestWSAnalyser {

	public static void main(String[] args) {
		String hex = "000004150010000000000005000000007B22636D64223A225359535F4D5347222C226D7367223A225C75353932375C75353163395C75356337315C75373935655C75373964385C75346562613A3F205C75393030315C75376564393A3F205C75376561365C75346631615C75353932375C75346635635C75363231385C75363234625C75366533383A3F20315C75346532615C75356330665C75393164315C75346562615C75666630635C75373062395C75353166625C75353234645C753566383054415C75373638345C75363233665C75393566345C75353362625C75363262645C75353935365C7535343237222C226D73675F74657874223A225C75353932375C75353163395C75356337315C75373935655C75373964385C75346562613A3F205C75393030315C75376564393A3F205C75376561365C75346631615C75353932375C75346635635C75363231385C75363234625C75366533383A3F20315C75346532615C75356330665C75393164315C75346562615C75666630635C75373062395C75353166625C75353234645C753566383054415C75373638345C75363233665C75393566345C75353362625C75363262645C75353935365C7535343237222C226D73675F636F6D6D6F6E223A225C75366533385C75363230665C75353333615C75356537665C75363461643A203C255C75353932375C75353163395C75356337315C75373935655C75373964385C7534656261253E205C75393030315C75376564393C25205C75376561365C75346631615C75353932375C75346635635C75363231385C75363234625C7536653338253E20315C75346532615C75356330665C75393164315C75346562615C75666630635C75373062395C75353166625C75353234645C753566383054415C75373638345C75363233665C75393566345C75353362625C75363262645C75353935365C7535343237222C226D73675F73656C66223A225C75366533385C75363230665C75353333615C75356537665C75363461643A203C255C75353932375C75353163395C75356337315C75373935655C75373964385C7534656261253E205C75393030315C75376564393C25205C75376561365C75346631615C75353932375C75346635635C75363231385C75363234625C7536653338253E20315C75346532615C75356330665C75393164315C75346562615C75666630635C75356665625C75363736355C75363262645C75353935365C7535343237222C22726570223A312C227374796C6554797065223A322C2275726C223A22687474703A5C2F5C2F6C6976652E62696C6962696C692E636F6D5C2F34313032393631222C22726F6F6D6964223A343130323936312C227265616C5F726F6F6D6964223A343130323936312C22726E64223A3432383638342C2262726F6164636173745F74797065223A307D";
		alalyseMsg(hex);
	}
	
	private static void alalyseMsg(String hexMsg) {
		byte[] bytes = BODHUtils.toBytes(hexMsg);
		String msg = new String(bytes);
		System.out.println(StrUtils.view(msg));
		System.out.println("====");
		
		int len = 0;
		do {
			len = getLen(hexMsg);
			if(len <= 32) {
				break;
			}
			String subHexMsg = hexMsg.substring(32, len);
			msg = new String(BODHUtils.toBytes(subHexMsg));
			System.out.println(StrUtils.view(msg));
			
			
			hexMsg = hexMsg.substring(len);
		} while(StrUtils.isNotEmpty(hexMsg));
	}
	
	private static int getLen(String hexMsg) {
		String hexLen = hexMsg.substring(0, 8);	// 消息的前8位是本条消息长度
		long len = BODHUtils.hexToDec(hexLen);
		return (int) (len * 2);
	}
	
}
